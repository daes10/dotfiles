---
- name: Update, upgrade and install apt packages on desktop host
  hosts: localhost
  become: true
  gather_facts: true
  vars:
    # packages within the default apt repo
    standard_pkgs:
      - vim
      - git
      - curl
      - atop
      - bleachbit
      - diffutils
      - flameshot
      - flatpak
      - gnome-software-plugin-flatpak
      - gnome-software-plugin-snap
      - gnome-tweaks
      - gufw
      - neovim
      - ntpdate
      - pipx
      - preload
      - ripgrep
      - synaptic
      - timeshift
      - xclip
      - zsh
      - fzf

    # packages from special repos
    special_pkgs:
      - fastfetch
      - gnome-shell-extension-manager
      - starship

    # packages from external repos
    external_pkgs:
      - proton-mail
      - warp-terminal

  tasks:
    - name: Get my user
      ansible.builtin.set_fact:
        remote_regular_user: "{{ ansible_env.SUDO_USER or ansible_user_id }}"

    - name: Update apt package index
      apt:
        update_cache: true

    - name: Upgrade all apt packages
      apt:
        upgrade: true

    - name: Clean up apt cache
      apt:
        autoclean: false
        autoremove: false

    - name: Install standard packages
      apt:
        name: "{{ standard_pkgs }}"
        state: present

    - name: Change shell to zsh
      ansible.builtin.user:
        name: "{{ remote_regular_user }}"
        shell: /usr/bin/zsh
